function Crossfader(a,b,c){function d(){var d,e,f;for(a.style.opacity=0,g.fillRect(0,0,h,i),g.drawImage(c,o,p),f=g.getImageData(0,0,h,i),g.fillRect(0,0,h,i),g.putImageData(b,0,0),e=b,k=g.createImageData(h,i),d=0;j>d;d+=1)l[d]=f.data[d],m[d]=e.data[d]-f.data[d],k.data[d]=255;a.style.opacity=1}function e(a){var b,c;for(c=k.data,b=0;j>b;b++)c[b]=l[b]+m[b]*a;g.putImageData(k,0,0),n+=1}function f(){var a=300,b=Math.PI/(2*a);return roquestAnim(function(a){e(Math.sin(a*b+Math.PI/2))},a)}var g=a.getContext("2d"),h=a.width,i=a.height,j=4*h*i,k=g.createImageData(h,i),l=new Array(j),m=new Array(j),n=0,o=(h-c.width)/2,p=(i-c.height)/2;return"undefined"!=typeof Int16Array&&(l=new Int16Array(j),m=new Int16Array(j)),d(),f()}function CCMove(a,b,c){function d(a,b){var c=b.reverse;i.fillRect(0,0,j.width,j.height),i.drawImage(a[1],(j.width-a[1].width)/2,(j.height-a[1].height)/2,a[1].width,a[1].height),a[1]=i.getImageData(0,0,j.width,j.height),i.fillRect(0,0,j.width,j.height),i.putImageData(a[0],0,0);var d=400,e=Math.PI/(2*d);return roquestAnim(function(b){var d=1.2*j.width,f=Math.sin(b*e*(4/3)),g=0>f?0:f*d;i.clearRect(0,0,j.width,j.height),i.putImageData(a[0],0-g*c,0),i.putImageData(a[1],(j.width-g)*c,0)},d).then(function(){i.putImageData(a[1],0,0)})}function e(a,b){var c=b.reverse;i.fillRect(0,0,j.width,j.height),i.drawImage(a[1],(j.width-a[1].width)/2,(j.height-a[1].height)/2,a[1].width,a[1].height),a[1]=i.getImageData(0,0,j.width,j.height),i.fillRect(0,0,j.width,j.height),i.putImageData(a[0],0,0);var d=325,e=j.width,f=Math.PI/2/d;return roquestAnim(function(d){var g=Math.sin(d*f),h=g*e;if(b.fade)for(var k=0,l=a[0].data.length;l>k;k+=4)a[0].data[k+3]=255*(1-g),a[1].data[k+3]=255*g;i.clearRect(0,0,j.width,j.height),i.putImageData(a[0],c*(0-h),0),i.putImageData(a[1],c*(j.width-h),0)},d)}function f(a){return new Crossfader(j,a[0],a[1])}function g(a){var b=1e3;a.x=a.x||0,a.y=a.y||0;var c=i.getImageData(a.x,a.y,a.img.width,a.img.height);switch(a.transition||"scaleIn"){case"fadeIn":return b=200,i.globalAlpha=0,roquestAnim(function(d){var e=Math.sin(d*(Math.PI/2)/b);i.globalAlpha=e,i.clearRect(a.x,a.y,a.img.width,a.img.height),i.putImageData(c,a.x,a.y),i.drawImage(a.img,a.x,a.y)},b).then(function(){});case"scaleIn":return b=100,roquestAnim(function(d){var e=Math.sin(d*(Math.PI/2)/b),f=a.img.width*e,g=a.img.height*e,h=a.x+(a.img.width-f)/2,j=a.y+(a.img.height-g)/2;i.clearRect(a.x,a.y,a.img.width,a.img.height),i.putImageData(c,a.x,a.y),i.drawImage(a.img,h,j,f,g)},b)}}function h(a,b){k[a]=b}var i=a,j=b;c=c||{},c.transition=c.transition||"defaultAnim";var k={crossfade:f,jumpcut:f,bounce:d,bounceback:d,slideAndFade:function(a,b){return b.fade=!0,e(a,b)},slide:e,defaultAnim:function(){return this.bounceback.apply(this,arguments)}},l={addPanelAnim:h,panels:function(a,b){return a=Array.isArray(a)?a:[null,a],a[0]=a[0]||i.getImageData(0,0,j.width,j.height),b=b||{},b.reverse=b.reverse?-1:1,b.transition=b.transition&&k[b.transition]?b.transition:c.transition,k[b.transition](a,b)},popup:g};return l}function CCPanelSet(a,b){b="number"==typeof b&&b>=0&&b<a.length?b:0;var c=[b,-1];return a.setView=function(){var b=a[c[0]];return b.type="panel",-1!==c[1]&&(b=b.popups[c[1]],b.popup=c[1],b.type="popup"),b.panel=c[0],a.currentView=b,a.currentIndex=c,a.onchange&&a.onchange(),b},a.next=function(){return a[c[0]].popups&&c[1]+1<a[c[0]].popups.length?c[1]++:c[0]+1<a.length&&(c[0]++,c[1]=-1),this.setView()},a.prev=function(){return c[0]-1>=0?(c[0]--,c[1]=-1):0===c[0]&&-1!==c[1]&&(c[1]=-1),this.setView()},a.goTo=function(a,b){return c[0]=a||0,c[1]=b||-1,this.setView()},a.isFirst=function(){return 0===a.currentIndex[0]&&-1===a.currentIndex[1]},a.isLast=function(){return a.currentIndex[0]===a.last[0]&&a.currentIndex[1]===a.last[1]},a.last=[a.length-1],a.last[1]=a[a.last[0]].popups?a[a.last[0]].popups.length-1:-1,a.setView(),a}!function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else Q=a()}(function(){"use strict";function a(a){return function(){return V.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===bb(a)||a instanceof R}function d(a,b){if(O&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(cb)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+cb+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===Q&&d>=S&&gb>=d}function i(){if(O)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return Q=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return r(a)?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,X(c,function(b,c){U(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=$(l.prototype),f=$(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=W(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):U(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&O)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||X(d,function(b,c){U(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=$(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return b(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){db.length=0,eb.length=0,fb||(fb=!0)}function x(a,b){fb&&(eb.push(a),db.push(b&&"undefined"!=typeof b.stack?b.stack:"(no stack) "+b))}function y(a){if(fb){var b=Y(eb,a);-1!==b&&(eb.splice(b,1),db.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ab(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return U(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function C(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})}function D(a,b,c){return k(a).spread(b,c)}function E(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?g.value:p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?h.value:z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function F(a){k.done(k.async(a)())}function G(a){throw new R(a)}function H(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return X(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){return p(a,function(a){return a=Z(a,k),p(J(Z(a,function(a){return p(a,T,T)})),function(){return a})})}function L(a){return k(a).allSettled()}function M(a,b){return k(a).then(void 0,void 0,b)}function N(a,b){return k(a).nodeify(b)}var O=!1;try{throw new Error}catch(P){O=!!P.stack}var Q,R,S=i(),T=function(){},U=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(g){if(f)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),g;setTimeout(function(){throw g},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0,f=!1;if(U=function(a){c=c.next={task:a,domain:f&&process.domain,next:null},d||(d=!0,e())},"undefined"!=typeof process&&process.nextTick)f=!0,e=function(){process.nextTick(a)};else if("function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=function(){e=h,g.port1.onmessage=a,a()};var h=function(){g.port2.postMessage(0)};e=function(){setTimeout(a,0),h()}}else e=function(){setTimeout(a,0)};return U}(),V=Function.call,W=a(Array.prototype.slice),X=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Y=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),Z=a(Array.prototype.map||function(a,b){var c=this,d=[];return X(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),$=Object.create||function(a){function b(){}return b.prototype=a,new b},_=a(Object.prototype.hasOwnProperty),ab=Object.keys||function(a){var b=[];for(var c in a)_(a,c)&&b.push(c);return b},bb=a(Object.prototype.toString);R="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var cb="From previous event:";k.resolve=k,k.nextTick=U,k.longStackSupport=!1,k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?W(arguments,1):c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return U(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var db=[],eb=[],fb=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return db.slice()},k.stopUnhandledRejectionTracking=function(){w(),fb=!1},w(),k.reject=z,k.fulfill=A,k.master=C,k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=E,k.spawn=F,k["return"]=G,k.promised=H,k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return U(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,W(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,W(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,W(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,W(arguments)])},k.fbind=function(a){var b=k(a),c=W(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(W(arguments))])}},o.prototype.fbind=function(){var a=this,b=W(arguments);return function(){return a.dispatch("apply",[this,b.concat(W(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.allResolved=j(K,"allResolved","allSettled"),o.prototype.allResolved=function(){return K(this)},k.allSettled=L,o.prototype.allSettled=function(){return this.then(function(a){return J(Z(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=M,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){U(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){c.reject(new Error(b||"Timed out after "+a+" ms"))},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=W(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=W(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=W(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=W(arguments,1);return function(){var c=b.concat(W(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=W(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=W(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(W(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=W(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=W(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=W(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=W(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=N,o.prototype.nodeify=function(a){return a?void this.then(function(b){U(function(){a(null,b)})},function(b){U(function(){a(b)})}):this};var gb=i();return k}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.performance=window.performance||{},performance.now=function(){return performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()}}();var roquestAnim=function(){function a(a,b){function c(){var b=a(e);b===!1?f.resolve():requestAnimFrame(c)}function d(){var c=performance.now()-e;c>=b?(a(b),f.resolve()):(a(c),requestAnimFrame(d))}var e,f=new Q.defer;return e=performance.now(),requestAnimFrame(b?d:c),f.promise}return a}(),CCLoader=function(){var a={};return a.oneImage=function(a){var b=new Q.defer,c=new Image;return c.onload=function(){b.resolve(this)},c.crossOrigin="anonymous",c.panel=a.panel,c.src=a.src,b.promise},a.onePanel=function(a){var b=[a],c=[];if(a.popups&&a.popups.length)for(var d=0,e=a.popups.length;e>d;d++)b.push(a.popups[d]);for(var f=0,g=b.length;g>f;f++)c.push(this.oneImage(b[f]));return Q.all(c)},a.batchPanels=function(a){var b=[];for(var c in a)b.push(this.onePanel(a[c]));return Q.all(b)},a}(),Canvasbook=function(a,b){function c(a){for(var b=0,c=a.panels.length;c>b;b++)if(a.panels[b].panel=b,a.panels[b].src=(a.panels[b].path||a.imgPath||"")+a.panels[b].src,a.panels[b].popups&&a.panels[b].popups.length>0)for(var d=0,e=a.panels[b].popups.length;e>d;d++)a.panels[b].popups[d].src=(a.panels[b].popups[d].path||a.imgPath||"")+a.panels[b].popups[d].src;return a}function d(){l.fillStyle=i.backgroundTextColor,l.clearRect(0,0,k.width,k.height),l.font="30pt Monaco",l.textAlign="center",l.fillText("LOADING...",k.width/2,k.height/2),l.fillStyle=i.backgroundColor}function e(a,b){return b=b||a+3,CCLoader.batchPanels(j.slice(a,b+1)).then(function(c){for(var d=0,e=c.length;e>d;d++){var f=c[d].shift();j[f.panel].img=f;for(var g=0,h=c[d].length;h>g;g++)j[f.panel].popups[g].img=c[d][g]}return[a,b]})}function f(a){a&&(n=!0,a.then(function(a){j.currentView.img=a.shift();for(var b=0,c=a.length;c>b;b++)j.currentView.popups[b].img=a[b];g(j.currentView),n=!1}))}function g(a){var b;n=!0,a.img||(a.img=m,b=CCLoader.onePanel(a)),"panel"===a.type&&l.fillRect(0,0,k.width,k.height);var c=a.x||(k.width-a.img.width)/2,d=a.y||(k.height-a.img.height)/2;l.drawImage(a.img,c,d,a.img.width,a.img.height),n=!1,f(b)}var h,i=a||{};i.backgroundColor=i.backgroundColor||"#fff",i.backgroundTextColor=i.backgroundTextColor||"#000";var j,k,l,m,n=!1,o={};return o.wasLast=!1,o.wasFirst=!0,o.previous=function(){return o.isFirst?"wasFirst":n?"moving":(j.prev(),n=!0,o.wasFirst=0===j.currentIndex[0],h.panels(j.currentView.img,{reverse:!0,transition:j.currentView.transition}).then(function(){return n=!1,j.currentView}))},o.next=function(){if(o.isLast)return"wasLast";if(!n){if(j.next(),n=!0,"popup"===j.currentView.type)return h.popup(j.currentView).then(function(){return n=!1,j.currentView});var a;return j.currentView.img||(j.currentView.img=m,a=CCLoader.onePanel(j.currentView)),h.panels(j.currentView.img,{transition:j.currentView.transition}).then(function(){return n=!1,f(a),j.currentView})}return"moving"},o.goTo=function(a,b){g(j.goTo(a,b))},o.isFirst=!0,o.isLast=!1,o.load=function(a,b){a=c(a);var f=this;j=new CCPanelSet(a.panels,a.startIndex),j.onchange=function(){f.currentView=j.currentView,f.currentIndex=j.currentIndex,f.isLast=j.isLast(),f.isFirst=j.isFirst()},j.onchange(),a=a||{},k="string"==typeof b?document.getElementById(b):b,l=k.getContext("2d"),l.fillStyle=i.backgroundColor;var n=a.move||{};return h=new CCMove(l,k,n),i.backgroundColor=a&&a.backgroundColor?a.backgroundColor:i.backgroundColor,d(),CCLoader.oneImage({src:k.toDataURL()}).then(function(a){m=a}),e(0,5).then(function(){g(j.currentView),e(6,j.length-1)}),this},a&&b?o.load(a,b):o};